<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Rendering</title>
    <style>
        /* Some basic CSS for demonstration */
        #container {
            width: 300px;
            height: 200px;
            position: relative;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>

<body>

    <div id="container">
        <img src="https://ouch-cdn2.icons8.com/RjiKOF2gGKiIVnIMFi0O1a4aU7DoHfhbkXr2JbUYZ3A/rs:fit:368:313/czM6Ly9pY29uczgu/b3VjaC1wcm9kLmFz/c2V0cy9wbmcvMzEy/LzliNDQ3MmVlLWZh/YjMtNDQwNy1iOWVh/LWMwOTdlYWNjNWE3/NS5wbmc.png"
            alt="Demo Image">
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            const container = $("#container");
            const imageElement = container.find("img");
            const width = Math.floor(imageElement.width());
            const height = Math.floor(imageElement.height());

            // Create canvas and get context
            const canvas = document.createElement("canvas");
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext("2d");
            container[0].appendChild(canvas);

            // Secondary canvas for reading image data
            const tempCanvas = document.createElement("canvas");
            tempCanvas.width = width;
            tempCanvas.height = height;
            const tempCtx = tempCanvas.getContext("2d");

            const image = new Image();
            image.src = imageElement.attr("src");
            image.onload = function () {
                tempCtx.drawImage(image, 0, 0, width, height);
                const imageData = tempCtx.getImageData(0, 0, width, height);

                let pixelData = [];
                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const index = (y * width + x) * 4;
                        const alpha = imageData.data[index + 3];
                        if (alpha > 1) {
                            const rgba = {
                                r: imageData.data[index],
                                g: imageData.data[index + 1],
                                b: imageData.data[index + 2],
                                a: alpha / 255
                            };
                            pixelData.push({
                                x: x,
                                y: y,
                                rgba: rgba
                            });
                        }
                    }
                }

                let threshold = 0;
                function render() {
                    for (let i = pixelData.length - 1; i >= 0; i--) {
                        if (pixelData[i].y <= threshold) {
                            ctx.fillStyle = `rgba(${pixelData[i].rgba.r}, ${pixelData[i].rgba.g}, ${pixelData[i].rgba.b}, ${pixelData[i].rgba.a})`;
                            ctx.fillRect(pixelData[i].x, pixelData[i].y, 1, 1);
                            pixelData.splice(i, 1);
                        }
                    }
                    threshold++;
                    if (threshold < height) {
                        setTimeout(render, 30);
                    }
                }

                setTimeout(render, 500);
            }
        });

    </script>
</body>

</html>